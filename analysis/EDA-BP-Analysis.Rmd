---
title: "EDA BP Report Analysis"
author: "Jessica Forsstrom"
date: "2022-10-24"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Background & Introduction

##### Every year, bp compiles a PDF with data and publishes it publicly as "bp Statistical Review of World Energy." They continually update a large dataset to include the newest worldly information on energy data ranging from information on energy consumption to key minerals. This data is part of a report that has been collecting world energy data since 1965. For the purposes of this exploratory analysis, I chose to focus on primary energy consumption and carbon emissions produced from 1965 to 2021. The bp curated dataset provides information on 92 countries, breaking them up into 7 regions: Africa, Asia Pacific, Commonwealth of Independent States (CIS), Europe, Middle East, North America, and South & Central America. The entire dataset also includes information on natural gas, oil (production, consumption, and prices), coal (production, consumption, and prices), nuclear energy consumption, hydroelectric energy consumption, and renewable energy consumption (solar power, wind, and biofuels). 

##### Bp is viewed as an oil giant, consistently providing gas from fossil fuels to cars and planes across the world. It is important to question why compiling this energy data benefits their company, when they profit from nonrenewable energy sources that are rapidly declining the health of our planet. Chief economist, Spencer Dale maintains that bp “remain[s] committed to playing [their] role as [they] pursue [their] net zero ambition.” He does not deny the importance of lowering carbon emissions, but he does attribute the “sharp rebound in energy demand [as] a sign of global success, driven by a rapid recovery in economic activity.” By looking at preliminary statistics from the primary energy consumption datasheet, there is a dip in energy consumption in 2020 (during the pandemic), followed by an increase in 2021, but equating economic success solely with energy consumption might be a flawed assumption. A scientific article about energy diversification uses bp’s dataset to ponder this exact question (Ahmed et al., 2022).

##### Overall, the quantity of data involved in this report allows for a broad range of research questions. It is a time-series dataset with information as far back as 1965. Many trends and changes over time can be calculated and analyzed by the given data. Since this is a world report, there is also information collected from a wide variety of regions, allowing some research to develop a focus in one area or one time period. By collecting primary energy consumption, oil usage, carbon emissions, renewable energy consumption, fossil fuels, key minerals, and economic growth, the diverse dataset allows research to be conducted in any of these energy categories as well. Due to the important relationship between energy consumption and carbon emissions, this report aims to analyze statistics from both categories, grouping data by year, country, and region. While bp provides primary energy consumption per capita data, this exploratory analysis focuses on the total energy consumption of each country to put into perspective at a worldly scale where energy is being highly consumed.


```{r include=FALSE}
#install.packages("tidyverse")
library(tidyverse)
```



```{r include=FALSE}
#importing energy consumption data and cleaning the data
consumption <- read_csv("energydata2.csv") %>%
  pivot_longer(c(`1965`:`2021`),
               names_to="year",
               values_to="consumption_EJ") %>%
  rename(c(region = "Region",country = "Country"))

head(consumption)
```



```{r include=FALSE}
#Carbon Emissions csv loading + cleaning
co2 <- read_csv("co2_2.csv") %>%
  pivot_longer(c(`1965`:`2021`),
                     names_to = "year",
                     values_to = "emissions_tonnes")
  #rename(c(region = "Region",country = "Country"))

head(co2)
```

### Methods
##### To quantify different types of energy consumption, bp used an ‘input-equivalent’ basis which used the amount of electricity generated by fossil fuels as a baseline to standardize all forms of energy consumption. All data was collected from national statistical agencies, international organizations, and other proprietary sources. Therefore, bp takes no blame for inaccurate or omitted data. Bp also uses a thermal equivalent efficiency factor to better reflect the recent increased in efficiency in power plants. Their method for collecting carbon emissions data comes from a variety of sources including Cedigaz, the Payne Institute for Public Policy, and the International Energy Agency (IEA). They then used an emission factor for combustion to represent the volume of carbon emissions entering the atmosphere. 

##### The data is publicly available through a large multi-sheet Excel file but contains extraneous information that has to be manually deleted. I extracted the relevant Excel sheets to make the dataset workable. By removing blank spaces and totals from bp’s polished dataset, I converted this rawer form of data into a CSV file to be manipulated in R. The regions were color coded in bp’s data, but each variable needed to be assigned a region to do any further analysis with this information. Bp stated that the regions are defined “purely for statistical purposes and are not intended to imply political or economic standings.” While there may be other inconsistencies in the data because they were collected from different government agencies, I noticed that from 1965 to 1984 the CIS only had values for the USSR with all other countries in that region had a value of 0. Then from 1985 to present, the USSR values became 0 and all other countries were populated with the corresponding primary energy consumption and carbon emissions values. Due to this, information from that region may be skewed. In order to include all necessary information across countries, no non-mutated values were removed. 

##### Using the tidyverse package in R, both data sheets (primary energy consumption and carbon emissions) needed to be formed into longer, “tidier” data. The primary energy consumption dataset consists of region, country, year, and consumption in exajoules which is the equivalent to 1 quintillion joules. Carbon emissions were measured in metric tonnes. It is important to note that there are more values of 0 in the earlier years of the dataset likely due to lack of resources at the time. Most countries tended to have a total carbon emissions value on the lower side with a few large exceptions. Multiple datasets were created to group the values by year, region, or country. Preliminary statistics also looked at both the sum and average values of emissions and primary energy consumption for each country. While it is useful to look at country data individually, I focused my analysis on regional and year groupings. I merged the two datasets by coordinating the first three columns to contain the same information. Merging the information on primary energy consumption and carbon emissions involved adding two unique columns with their respective values to the first three. This created a workable dataset to perform analysis on the correlation between carbon emissions and primary energy consumption based off years, region, or country.

##### Due to the large quantity of data points in some of the regions, multiple graphs were created to further look at the relationship between carbon emissions and primary energy consumption. Each region was color coded and faceted to show all the data on the same scale but on separate graphs. To further analyze the differences among the countries in each region, individual region graphs were created and scaled appropriately to give a more detailed picture of the trends between carbon emissions and primary energy consumption. Each region graph was then color coded by country, accounting for values that differ drastically within their region. 

```{r include=FALSE}
###Gathering Scope and Contour of the CO2 Dataset

#group by region and find total emissions for each region
regiontotal <- co2 %>%
  group_by(region) %>%
  summarize(totalemissions = sum(emissions_tonnes))

#looking at the table
view(regiontotal)

#totaling emissions by country 
country <- co2 %>%
  group_by(country) %>%
  summarize(total_emissions = sum(emissions_tonnes))

#histogram showing the distribution of emissions
hist(country$total_emissions, main = "Frequency of Total Emissions Grouped by Country", xlab = "Total Emissions", breaks = 30)
```

### Results & Discussion 

##### Looking at total emissions from 1965 to 2021 for each region, the Asia Pacific region was found to have the highest value of 454,645.91 metric tonnes, and Africa had the lowest accumulated emissions with a value of only 40,629.47 metric tonnes. South and Central America had a value similar to Africa. I also looked at the max values of each country’s emissions and used a frequency plot to analyze which years tended to have the highest emission values compared to other years. As expected, the year when most countries produced the maximum amount of carbon emissions was 2019. The graph is skewed strongly to the left and ranges from 1972 to 2021 although some years did not contain a maximum value for any country in between this range. 

```{r echo=FALSE}
#plotting total emissions for each region
ggplot(regiontotal, aes(region, totalemissions)) +
  labs(x = "Region", y = "Total Emissions", title = "Total Emissions by Region") +
  geom_bar(stat = "identity")

```

Figure 1. Bar plot of total carbon emissions (in tonnes) for each region 
 

```{r include=FALSE}
#data set for max emissions grouped by country, still include year in the dataset 
maxcountry <- co2 %>%
  select(country, year, emissions_tonnes) %>%
  group_by(country) %>%
  filter(emissions_tonnes== max(emissions_tonnes)) %>%
  rename(max_emissions = "emissions_tonnes") 

view(maxcountry)
```


```{r echo=FALSE}
#plotting to look at which years each country had their max emissions output 
ggplot(maxcountry, aes(year)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle=45, vjust=1, hjust=1))
```

Figure 2. Bar plot of the frequency of years that contain the maximum value emissions for each country
 

##### I also isolated the average carbon emissions for each year, creating a dataset and graph that contained world emission values by year. There is a relatively strong linear increase as time increases with some curves and dips. While there are a few notable dips in the average carbon emissions as seen in 2009 and 2019, there is still a sharp increase which is expected to correlate with primary energy consumption. The world average for carbon emissions according to the dataset was 122 metric tonnes in 1965. In 2018, the world average reached its peak value of 375 metric tonnes and in 2019 and 2021, the average was similarly as high. 

```{r echo=FALSE}
#grouping by year, looking at average emissions
co2year <- co2 %>%
  group_by(year) %>%
  summarize(avg_emis = mean(emissions_tonnes)) 

ggplot(co2year, aes(year,avg_emis)) +
  geom_point() + 
  theme(axis.text.x = element_text(angle=90, vjust=1, hjust=1)) +
  labs(y = "average emissions (tonnes)", title = "Average World Emissions by Year")
```

Figure 3. Average world carbon emissions over time from 1965 to 2021
 

##### By both grouping by year and filtering the data to still include the country and emission values, a maximum emission value was found each year and corresponded to a country. A frequency plot looked at which countries tended to have the highest emission values each year. Out of all 92 countries, only two appeared on the frequency plot showing that for every year from 1965 to 2021, either China or the United States released the most amount of carbon emissions. The United States had the maximum amount of carbon emissions for 40 of the years and China had the maximum amount for about 17.  

```{r echo=FALSE}
#grouping by year, looking at max emissions, finding which countries correspond
maxperyear <- co2 %>%
  subset(region != "CIS") %>%
  select(country, year, emissions_tonnes) %>%
  #subset(country != "Russian Federation") %>%
  #subset(country != "USSR") %>%
  group_by(year) %>%
  top_n(5, emissions_tonnes) %>%
  rename(max_emis = "emissions_tonnes")
    
ggplot(maxperyear, aes(fct_infreq(country))) +
  geom_bar() +
  labs(x = "Country", y = "Frequency", title = "Frequency a Country is a Top 5 CO2 Emitter for a given Year") +
  theme_classic()
```

Figure 4. Bar plot of frequency of country containing the largest value of carbon emissions in a given year
 
```{r}
#grouping by country, looking at top 5 countries total emission countries, finding which countries correspond
country_top_5 <- country %>%
  subset(country != "Russian Federation") %>%
  subset(country != "USSR") %>%
  top_n(5, total_emissions) 
    
ggplot(country_top_5, aes(x= reorder(country,-total_emissions), y = total_emissions)) +
  geom_bar(stat="identity") +
  labs(x = "Country", y = "Total Emissions (tonnes)", title = "Total Emissions from 1965-2021 for the Top 5 Countries") +
  theme_classic()

country_top_3 <- co2 %>%
  filter(country == "Japan" | country == "China" | country ==  "US" | country == "India" | country == "Germany")

ggplot(country_top_3, aes(year, emissions_tonnes, group = country, color = country)) +
  geom_line(size = 1) +
  theme_classic()+
  labs(x = "Year", y = "Emissions (tonnes)", title = "Carbon Emissions over time for the Top 5 Countries") +
  theme(axis.text.x = element_text(angle=90, vjust=0.5, hjust=1)) 
```



##### Total energy consumption grouped by country also tended to be on the lower side with a few extreme outliers. When looking at total primary energy consumption for each region, the Asia Pacific region had the highest amount of total energy consumed at 6,339 exajoules. North America followed with a total of 5,593 exajoules of total primary energy consumed. The region that consumed the least amount of energy was Africa at 590 exajoules. The total energy consumption per region yields a surprisingly different result from the average energy consumption per region. Looking at the averages, North America, at about 33 exajoules, has a much higher average consumption value than all other regions whose energy consumption all averaged around 3 exajoules. 

```{r include=FALSE}
#Gathering Scope and Contour of the consumption Dataset
ccountry <- consumption %>%
  group_by(country) %>%
  summarize(total_consump = sum(consumption_EJ))

hist(ccountry$total_consump)

#group by region and find total consumption for each region
regionc <- consumption %>%
  group_by(region) %>%
  summarize(total_consump = sum(consumption_EJ))

#looking at the table
view(regionc)

#average consumption
regionavg <- consumption %>%
  group_by(region) %>%
  summarize(avg_consump = mean(consumption_EJ))

#looking at the table
view(regionavg)

```


```{r echo=FALSE}
#plotting total emissions for each region
ggplot(regionc, aes(region, total_consump)) +
  labs(x = "Region", y = "Total Consumption (EJ)", title = "Total Consumption by Region") +
  geom_bar(stat = "identity")
```

Figure 5. Total primary energy consumption from 1965 to 2021 for each region 
 

```{r echo=FALSE}
#plotting average emissions for each region
ggplot(regionavg, aes(region, avg_consump)) +
  labs(x = "Region", y = "Average Consumption (EJ)", title = "Overall Average Consumption by Region") +
  geom_bar(stat = "identity")
```

Figure 6. Average primary energy consumption from 1965 to 2021 for each region 

##### Plotting the frequency of countries that contained the maximum primary energy consumption by year produced a similar result as the bar plot for carbon emissions. Out of all the years from 1965 to 2021, only either China or the United States consumed the largest amount of primary energy. The United States held the maximum value for about 44 of the years and China for about 13 of them. 

```{r echo=FALSE}
#grouping by year, looking at max emissions, finding which countries correspond
maxperyearconsump <- consumption %>%
  select(country, year, consumption_EJ) %>%
  group_by(year) %>%
  filter(consumption_EJ == max(consumption_EJ)) %>%
  rename(max_consump = "consumption_EJ")
    
ggplot(maxperyearconsump, aes(country)) +
  geom_bar()

```

Figure 7. Frequency of countries with the maximum amount of primary energy consumption in a given year

##### There was also an extremely similar trend between the average world energy consumption over time and the average carbon emissions over time. The two notable dips fall at the same years and the graph maintains a linear positive trend over time. The minimum average energy consumption was only 1.7 exajoules in 1965. The largest average energy consumption occurred in 2021, the most recent year in the data set, and it was about 6.5 exajoules. 

```{r echo=FALSE}
#average consumption over time
yearavgcon <- consumption %>%
  group_by(year) %>%
  summarize(avg_consump = mean(consumption_EJ)) 

ggplot(yearavgcon, aes(year,avg_consump)) +
  geom_point() + 
  theme(axis.text.x = element_text(angle=90, vjust=1, hjust=1)) +
  labs(y = "average consumption (EJ)", title = "Average World Consumption by Year")
```

Figure 8. Average world primary energy consumption over time from 1965 to 2021


##### When comparing carbon emission values with primary energy consumption, across all regions, there is a strong, positive, linear correlation throughout the entire dataset. The Asia Pacific region has the widest range of both carbon emission values (10,523 tonnes) and primary energy consumption (157.6 exajoules) but also contains a large quantity of data points. However, when analyzing the countries within the Asia Pacific region, China is the only country whose emissions are higher than 3000 exajoules and whose energy consumption is higher than 50 exajoules. All other countries in the region are clustered in the lower left quadrant of the graph likely due to their smaller size and differing resource access.

```{r echo=FALSE}
#joining the datasets 
data <- left_join(consumption,
                  co2,
                  by = c("country","year","region"))

ggplot(data, aes(consumption_EJ, emissions_tonnes, color = region)) +
  geom_point()


```

Figure 9. Scatter plot of all primary energy consumption plotted against carbon emissions for all data points color coded by region

```{r echo=FALSE}
ggplot(data, aes(consumption_EJ, emissions_tonnes, color = region)) +
  geom_point() +
  facet_wrap(vars(region))
```

Figure 10. Facet wrapped scatter plots grouped by region showing carbon emissions vs. primary energy consumption

```{r echo=FALSE}
asiapac <- data %>%
  filter(region == "Asia Pacific")

#max(asiapac$consumption_EJ)
#max(asiapac$emissions_tonnes)

ggplot(asiapac, aes(consumption_EJ, emissions_tonnes, color = country)) +
  geom_point() +
  coord_cartesian(xlim = c(0,175), ylim = c(0,11000))+
  labs(title = "Asia Pacific")

```

Figure 11. Carbon emissions and primary energy consumption for the Asia Pacific region, color coded by country

##### Within Africa, most countries followed the same trendline, however South Africa had a steeper slope, meaning that as primary energy consumption increased, carbon emissions increased more in South Africa than other countries in the region. South Africa held the peak emissions and primary energy consumption values for the region at 476.0 tonnes and 5.4 exajoules respectively. The relationship between primary energy consumption and carbon emissions is extremely linear in this region, likely with a correlation coefficient near 1 for each individual country.

```{r include=FALSE}
#going by region
africa <- data %>%
  filter(region == "Africa")

max(africa$consumption_EJ)
max(africa$emissions_tonnes)

cis <- data %>%
  filter(region == "CIS")

max(cis$consumption_EJ)
max(cis$emissions_tonnes)

europe <- data %>%
  filter(region == "Europe")

max(europe$consumption_EJ)
max(europe$emissions_tonnes)

mideast <- data %>%
  filter(region == "Middle East")

max(mideast$consumption_EJ)
max(mideast$emissions_tonnes)

namerica <- data %>%
  filter(region == "North America")

max(namerica$consumption_EJ)
max(namerica$emissions_tonnes)


scamerica <- data %>%
  filter(region == "S. & Cent. America")

max(scamerica$consumption_EJ)
max(scamerica$emissions_tonnes)
```



```{r echo=FALSE}
ggplot(africa, aes(consumption_EJ, emissions_tonnes, color = country)) +
  geom_point() +
  coord_cartesian(xlim = c(0,6), ylim = c(0,500))+
  labs(title = "Africa")
```

Figure 12. Carbon emissions and primary energy consumption for the Africa region, color coded by country

##### There is a lot more variation in the CIS region between countries. The USSR has a uniform, linear trend which reaches the maximum amount of emissions at 3474.6 tonnes and the maximum amount of primary energy consumption at 53.7 exajoules. The Russian Federation has similar primary energy consumption values but lower carbon emissions associated with those years. All other countries in the CIS region have emission values below 500 tonnes and energy consumption below 5 exajoules. 


```{r echo=FALSE}

ggplot(cis, aes(consumption_EJ, emissions_tonnes, color = country)) +
  geom_point() +
  coord_cartesian(xlim = c(0,60), ylim = c(0,4000))+
  labs(title = "Commonwealth of Independent States")

```

Figure 14. Carbon emissions and primary energy consumption for the CIS region, color coded by country

##### The sheer number of countries in Europe in this dataset make it difficult to discern how linear the relationship between primary energy consumption and carbon emissions is for the region. The data points are more varied and spread out, yet they still maintain a positive correlation. Interestingly, the datapoint which represents the maximum amount of energy consumption (15.8 exajoules) is different than the datapoint that represents the largest amount of carbon emissions (1,116.4 tonnes). 



```{r echo=FALSE}

ggplot(europe, aes(consumption_EJ, emissions_tonnes, color = country)) +
  geom_point() +
  coord_cartesian(xlim = c(0,20), ylim = c(0,1500))+
  labs(title = "Europe")

```

Figure 15. Carbon emissions and primary energy consumption for the Europe region, color coded by country

##### The relationship between primary energy consumption and carbon emissions in the Middle East has an extremely strong positive linear correlation. All the countries in the Middle East have a trend with about the same slope making the data almost completely linear for the entire region. Iran holds the maximum value for primary energy consumption at 12.2 exajoules and the maximum value for carbon emissions at 660.5 tonnes. Saudi Arabia has the second highest values and United Arab Emirates has the third. The other countries in the Middle East region have lower values below 200 tonnes and 3 exajoules. 


```{r echo=FALSE}
ggplot(mideast, aes(consumption_EJ, emissions_tonnes, color = country)) +
  geom_point() +
  coord_cartesian(xlim = c(0,15), ylim = c(0,700))+
  labs(title = "Middle East")
```

Figure 16. Carbon emissions and primary energy consumption for the Middle East region, color coded by country

##### In North America, the United States is much higher in general for both primary energy consumption and carbon emissions. The maximum value of primary energy consumption for both the US and the region is 97.4 exajoules, and the maximum value of carbon emissions is 5,884.2 tonnes. The minimum value for primary energy in the US is 52.0 exajoules which is much higher than the other 2 countries in the region. Similarly for carbon emissions, the minimum value in the US is 3,451.9 tonnes. Mexica and Canada both still have a positive correlation between primary energy consumption and carbon emissions, but their values are both all below 1000 tonnes and 25 exajoules. 

```{r echo=FALSE}
ggplot(namerica, aes(consumption_EJ, emissions_tonnes, color = country)) +
  geom_point() +
  coord_cartesian(xlim = c(0,100), ylim = c(0,6000))+
  labs(title = "North America")
```

Figure 17. Carbon emissions and primary energy consumption for the North America region, color coded by country

##### Lastly, in the South and Central America region, Brazil has the both the highest energy consumption (12.7 exajoules) and carbon emissions value (505.2 tonnes). All other countries in the region have values below 200 tonnes and 5 exajoules. The other countries tend to have a slightly steeper slope than Brazil, but they all generally follow the same positive, linear trend. 

```{r echo=FALSE}

ggplot(scamerica, aes(consumption_EJ, emissions_tonnes, color = country)) +
  geom_point() +
  coord_cartesian(xlim = c(0,15), ylim = c(0,520)) +
  labs(title = "South and Central America")

```

Figure 18. Carbon emissions and primary energy consumption for the South and Central America region, color coded by country

##### Overall, the relationship between primary energy consumption and carbon emissions seem to directly correlate. There is a relatively strong linear correlation across all regions. There is also a continual increase in both primary energy consumption and carbon emissions as time goes on. This is important information regarding the future of our world as indicated by the growing threat of climate change. It is also interesting to look at the scale of both carbon emissions and primary energy consumption because the data for both are so similar. The US and China seem to have much higher values than the other countries in the dataset which is also important to note. Further research using this dataset could analyze energy consumption or carbon emissions at a specific country or region over time. It is clear there is a valuable relationship between primary energy consumption and carbon emissions, and as the world moves toward renewable energy as a primary energy source, hopefully the rise in carbon emissions will start to go down. 

### References

##### Ahmed, Nihal, et al. “Energy Diversification: A Friend or Foe to Economic Growth in Nordic Countries? A Novel Energy Diversification Approach.” MDPI, Multidisciplinary Digital Publishing Institute, 27 July 2022, https://www.mdpi.com/1996-1073/15/15/5422. 

##### “Bp Statistical Review of World Energy 2022 | 71st Edition.” Bp, 2022, https://www.bp.com/content/dam/bp/business-sites/en/global/corporate/pdfs/energy-economics/statistical-review/bp-stats-review-2022-full-report.pdf. 




